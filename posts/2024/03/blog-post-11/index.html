<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Installing OpenFOAM on MacOS with Docker | Shubham Goswami, PhD </title> <meta name="author" content="Shubham Goswami, PhD"> <meta name="description" content="Personal and professional website of Shubham Goswami, PhD. "> <link rel="stylesheet" href="/goswami-13/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/goswami-13/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/goswami-13/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/goswami-13/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/goswami-13/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://goswami-13.github.io/goswami-13/posts/2024/03/blog-post-11/"> <script src="/goswami-13/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/goswami-13/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.css" integrity="sha256-q9ba7o845pMPFU+zcAll8rv+gC+fSovKsOoNQ6cynuQ=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css" integrity="sha256-Oppd74ucMR5a5Dq96FxjEzGF7tTw2fZ/6ksAqDCM8GY=" crossorigin="anonymous" media="screen and (prefers-color-scheme: light)"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css" integrity="sha256-nyCNAiECsdDHrr/s2OQsp5l9XeY2ZJ0rMepjCT2AkBk=" crossorigin="anonymous" media="screen and (prefers-color-scheme: dark)"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html@3.4.47/bundles/css/diff2html.min.css" integrity="sha256-IMBK4VNZp0ivwefSn51bswdsrhk0HoMTLc2GqFHFBXg=" crossorigin="anonymous"> <link defer rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css"> <script src="/goswami-13/assets/js/distillpub/template.v2.js"></script> <script src="/goswami-13/assets/js/distillpub/transforms.v2.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Installing OpenFOAM on MacOS with Docker",
            "description": "",
            "published": "March 25, 2024",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/goswami-13/"> <span class="font-weight-bold">Shubham</span> Goswami, PhD </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/goswami-13/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/goswami-13/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/goswami-13/blog/">Guides </a> </li> <li class="nav-item "> <a class="nav-link" href="/goswami-13/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/goswami-13/teaching/">Teaching </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Installing OpenFOAM on MacOS with Docker</h1> <p></p> </d-title> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> </nav> </d-contents> <p>Mac users, rejoice! This guide eliminates the roadblocks to running OpenFOAM on your Mac. Harnessing the power of Docker, we’ll navigate the process of compiling and running OpenFOAM, opening a world of CFD possibilities on your familiar platform.</p> <figure> <img src="https://goswami-13.github.io/images/Blog11/wer1656-fig-0002-m.jpg" width="80%"> </figure> <p>As a dedicated Macintosh user, I’ve often pondered: Is macOS the ideal environment for development? Without a doubt, the answer is a resounding yes. Gone are the days of relying solely on native Linux workstations for development. Today, developers overwhelmingly prefer the convenience of MacBooks or Windows PCs equipped with Windows Subsystem for Linux (WSL). Both macOS and Linux environments share a Unix-based foundation, making them highly comparable in structure. And what’s a MacBook without its beloved terminal? But let’s set aside our love for Macs for a moment and focus on a pertinent question: What about Computational Fluid Dynamics (CFD) and OpenFOAM? Can macOS serve as a viable option for testing and running simple cases in OpenFOAM? Can you seamlessly run custom solvers and integrate external libraries like PETSc into OpenFOAM? In my experience, the answer is a resounding <strong>yes</strong>. macOS offers an incredibly convenient development environment. Integrating OpenFOAM into macOS not only provides a consistent CFD environment but also caters to the needs of developers and enthusiasts alike. Whether you’re testing new solvers, experimenting with external libraries, or simply honing your skills, macOS offers a robust platform for exploring the world of Computational Fluid Dynamics.</p> <figure> <img src="https://goswami-13.github.io/images/Blog11/containers.png" width="80%"> </figure> <p>In the not-so-distant past, running OpenFOAM on anything other than Linux posed quite a challenge. Attempting to run OpenFOAM on Windows or macOS often necessitated virtual machines or dual-boot setups, which, while functional, were cumbersome and counterintuitive. However, with the advent of Windows Subsystem for Linux (WSL) on Windows, many of the hurdles associated with OpenFOAM installation were alleviated. You can find a comprehensive guide on compiling OpenFOAM on WSL in my previous article <a href="https://medium.com/stackademic/installing-openfoam-on-ubuntu-and-windows-wsl-9ab51f60d774" rel="external nofollow noopener" target="_blank">here</a>. Similarly, on macOS, a comparable setup can be achieved using Docker and containerization. Docker, originally an open-source project, was designed for running, building, and managing software containers to ensure consistent development environments across different operating systems. Containers operate on a simple premise: much like standardized shipping containers streamline global logistics, Docker containers encapsulate code and its dependencies into self-contained environments that can be deployed on any operating system. By packaging your OpenFOAM CFD environment into a Docker container, you gain the flexibility to run OpenFOAM seamlessly across diverse platforms.</p> <p><strong>Note:</strong> Before proceeding further, a word of caution: if your OpenFOAM simulations demand maximum performance from your hardware, Docker may not be the optimal solution. While Docker facilitates cross-platform compatibility, it does come with certain limitations. For instance, running Paraview or VisIt within a Docker environment can be cumbersome, and integrating external solvers like PETSc poses its own challenges.</p> <p>With that said, let’s dive into the intricacies of leveraging Docker for OpenFOAM on macOS!</p> <h2 id="installing-docker">Installing Docker</h2> <p>Firstly, if you haven’t already installed <a href="https://brew.sh/" rel="external nofollow noopener" target="_blank">Homebrew</a>, let’s get that set up. Open a terminal and execute the following command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/bash <span class="nt">-c</span> <span class="s2">"</span><span class="si">$(</span>curl <span class="nt">-fsSL</span> https://raw.githubusercontent.com/Homebrew/install/master/install.sh<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div> <p>This script automates the installation of Homebrew for you. If you’re unfamiliar, Homebrew is a package manager for macOS (and Linux). As their website elegantly puts it, “The script explains what it will do and then pauses before it does it.”</p> <p>Now, to install Docker, simply type the following command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>docker
</code></pre></div></div> <p>That’s all there is to it. Homebrew will locate and download the Docker package, then run the installer. After installation, you’ll just need to follow the Docker GUI for the initial configuration. To verify the installation, execute <code class="language-plaintext highlighter-rouge">docker --version</code> in the terminal. The output should display something like <code class="language-plaintext highlighter-rouge">Docker version 25.0.3, build 4debf41</code>. If the command doesn’t return a version number, start the Docker daemon first. You can do this by searching for Docker in Spotlight or navigating to the Application folder in Finder and launching it. When Docker is running, you should see its icon in the status bar.</p> <figure> <img src="https://goswami-13.github.io/images/Blog11/DockerDaemon.png" width="80%"> </figure> <h3 id="preferences">Preferences</h3> <p>After installing Docker, you can begin using it right away or customize it to suit your preferences. Here are some settings I find helpful for streamlining my workflow. Click on the small gear-shaped icon on the Docker daemon or click on the Docker icon in the status bar and navigate to settings. Here, you’ll find options for customization.</p> <p>Firstly, I opt to have Docker start automatically on start-up, given that I use it daily. In the preferences, I check the box for “Start Docker Desktop when you sign in to your computer.” However, be mindful that enabling this option keeps Docker running in the background, consuming resources. If you only use Docker sporadically, leaving this option unchecked can help conserve resources. Docker typically starts up in just a few seconds.</p> <figure> <img src="https://goswami-13.github.io/images/Blog11/Resources.png" width="80%"> </figure> <p>Next, head to the resources section to adjust allocations. Here, you can allocate CPU, RAM, and swap disk space, as well as set the disk size for Docker to use. If you’re only testing, it’s fine to stick with the default settings. However, if you frequently work with multiple containers simultaneously, allocating more resources to Docker makes sense. Personally, I assign all available CPUs and RAM to Docker, as I use it extensively for setting up OpenFOAM cases, testing them, and preparing them for execution on a computing cluster.</p> <figure> <img src="https://goswami-13.github.io/images/Blog11/Dockersettings.png" width="80%"> </figure> <h2 id="installing-openfoam-in-docker">Installing OpenFOAM in Docker</h2> <h3 id="using-the-pre-built-container-images">Using the pre-built container images</h3> <p>To get started with OpenFOAM in Docker, first, download the OpenFOAM Docker run script from <a href="https://github.com/goswami-13/OpenFOAM_Docker.git" rel="external nofollow noopener" target="_blank">Here</a> and place it at a convenient location. I typically recommend using the <code class="language-plaintext highlighter-rouge">/User/userName/OpenFOAM/</code> folder. (Note: You may need to create the <code class="language-plaintext highlighter-rouge">OpenFOAM</code> folder if it doesn’t already exist).</p> <p>Next, make the script executable and select the OpenFOAM version and image flavors by running the following commands in the terminal:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x openfoam-docker
<span class="nb">ln</span> <span class="nt">-sf</span> openfoam-docker openfoam2312-default
</code></pre></div></div> <p>In this example, I’ll select OpenFOAM version 23.12 and the <code class="language-plaintext highlighter-rouge">-run</code> image. Here’s a brief overview of the available images:</p> <ol> <li> <code class="language-plaintext highlighter-rouge">-run:</code> This image is small in size and designed for runtime usage only. It includes essential components of OpenFOAM, such as solvers, utilities, and libraries, but excludes tutorials and code modification capabilities.</li> <li> <code class="language-plaintext highlighter-rouge">-dev:</code> Slightly larger in size, this image includes the minimalist package along with the developer package, enabling code modifications. Tutorials are still not included in this image.</li> <li> <code class="language-plaintext highlighter-rouge">-default:</code> This image is the just-give-me-everything package, containing all available components.</li> </ol> <p>These images utilize the latest Ubuntu LTS version to ensure a relatively small basic container size (around 80 Mb). However, their sizes vary significantly, with the <code class="language-plaintext highlighter-rouge">-run</code> image being the smallest at about 300 Mb and the <code class="language-plaintext highlighter-rouge">-default</code> image being the largest at approximately 1.2 Gb. For development purposes, I recommend the <code class="language-plaintext highlighter-rouge">-dev</code> or <code class="language-plaintext highlighter-rouge">-default</code> images as they contain a full OpenFOAM development environment, complete with wmake, wclean, and other developmental commands.</p> <p>Now, let’s verify that the script can be executed by running the following command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./openfoam-docker <span class="nt">-help</span>
./openfoam-docker <span class="nt">-help-full</span>
</code></pre></div></div> <p>Don’t forget to include <code class="language-plaintext highlighter-rouge">./</code> before <code class="language-plaintext highlighter-rouge">openfoam-docker</code>, otherwise, the command won’t execute. Before running the Docker, let’s see how the script calls Docker without actually executing anything by using <code class="language-plaintext highlighter-rouge">./openfoam-docker -dry-run</code>. The output should resemble the following:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">-t</span> <span class="nt">-i</span> <span class="nt">--user</span><span class="o">=</span>1000:1000 <span class="nt">--volume</span><span class="o">=</span>/home/goswami/OpenFOAM:/home/openfoam opencfd/openfoam-default:latest
</code></pre></div></div> <p>Let’s break down what this command does. We’re attempting to run a Docker image named <code class="language-plaintext highlighter-rouge">opencfd/openfoam-run:latest</code>. The <code class="language-plaintext highlighter-rouge">--rm</code> flag specifies to automatically remove the container after we’ve finished with it. <code class="language-plaintext highlighter-rouge">-ti</code> flags tell Docker to use the container as an interactive terminal, similar to a Linux bash terminal. <code class="language-plaintext highlighter-rouge">--user=1000:1000</code> specifies Docker to run as the given user. Lastly, with the <code class="language-plaintext highlighter-rouge">--volume</code> key, Docker is instructed to mount the <code class="language-plaintext highlighter-rouge">/home/goswami/OpenFOAM</code> folder on WSL to the <code class="language-plaintext highlighter-rouge">/home/openfoam</code> directory in the container. This entire command is encapsulated in the link file we created as <code class="language-plaintext highlighter-rouge">openfoam2312-default</code>. Thus, running <code class="language-plaintext highlighter-rouge">./openfoam2312-default</code> command will launch the Docker and initialize the image with an OpenFOAM environment.</p> <p>To execute the Docker image, navigate to <code class="language-plaintext highlighter-rouge">/User/userName/OpenFOAM/</code> and input the following command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./openfoam2312-default
</code></pre></div></div> <p>This will initiate an interactive shell with the OpenFOAM environment active, with the current local directory mounted within the container. Please note that the initial execution of the script may take longer as the image will be downloaded from <a href="https://hub.docker.com/" rel="external nofollow noopener" target="_blank">Docker Hub</a>.</p> <p>Lastly, to simplify the process of navigating to the directory and running the script, let’s create an alias in the <code class="language-plaintext highlighter-rouge">.bash_profile</code> file. Open a terminal and edit the <code class="language-plaintext highlighter-rouge">.bash_profile</code> file using any text editor, such as vim:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi ~/.bash_profile
</code></pre></div></div> <p>Navigate to the end of this file and add the following lines:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">OF2312</span><span class="o">=</span><span class="s1">'cd /User/userName/OpenFOAM; ./openfoam2312-default'</span>
</code></pre></div></div> <p>Now, open a new terminal and type in the alias <code class="language-plaintext highlighter-rouge">OF2312</code> to initiate the OpenFOAM Docker environment!</p> <h3 id="building-your-own-docker-image">Building your own docker image</h3> <p>The first method of compiling OpenFOAM in a Docker on your Mac works wonders, but what if you desire a more customized setup than the standard OpenFOAM Docker image? For instance, what if you wish to incorporate external solvers like PETSc? <a href="https://petsc.org/release/" rel="external nofollow noopener" target="_blank">PETSc</a>, or the Portable, Extensible Toolkit for Scientific Computation, stands out as a robust tool engineered for the scalable resolution of scientific applications governed by partial differential equations (PDEs). At the heart of PETSc’s versatility lies its organizational structure, tailored around mathematical concepts, making it adept at solving complex systems. Within OpenFOAM, a dedicated library named petsc4Foam is built to access PETSc solvers, such as <a href="https://computing.llnl.gov/projects/hypre-scalable-linear-solvers-multigrid-methods" rel="external nofollow noopener" target="_blank">HYPRE</a>.</p> <p>In this guide, let’s embark on building a Docker container with PETSc integrated into OpenFOAM.</p> <p>For such customizations, it’s recommended to construct your container image rather than relying on the standard OpenFOAM image. There are two primary techniques to achieve this: using a Dockerfile or using a base Ubuntu image and compiling OpenFOAM and PETSc within OpenFOAM. Follow <a href="https://medium.com/stackademic/setting-up-petsc-in-openfoam-a635713f9428" rel="external nofollow noopener" target="_blank">this guide</a> for the latter. While the latter method can be cumbersome, the former offers the most reproducible, version-controllable, and transparent approach to image building. For this purpose, you’ll need a Dockerfile similar to the one below:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ---------------------------------*-sh-*------------------------------------</span>
<span class="c"># Copyright (C) 2021-2022 OpenCFD Ltd.</span>
<span class="c"># SPDX-License-Identifier: (GPL-3.0+)</span>
<span class="c">#</span>
<span class="c"># Add default (tutorials etc) layer onto the openfoam '-dev' (Ubuntu) image.</span>
<span class="c">#</span>
<span class="c"># Example</span>
<span class="c">#     docker build -f openfoam-default.Dockerfile .</span>
<span class="c">#     docker build --build-arg FOAM_VERSION=2306</span>
<span class="c">#         -t opencfd/openfoam-default:2306 ...</span>
<span class="c">#</span>
<span class="c"># ---------------------------------------------------------------------------</span>
ARG <span class="nv">FOAM_VERSION</span><span class="o">=</span>2312

FROM opencfd/openfoam-dev:<span class="k">${</span><span class="nv">FOAM_VERSION</span><span class="k">}</span>
ARG FOAM_VERSION
ARG <span class="nv">PACKAGE</span><span class="o">=</span>openfoam<span class="k">${</span><span class="nv">FOAM_VERSION</span><span class="k">}</span><span class="nt">-default</span>
ARG <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive

SHELL <span class="o">[</span><span class="s2">"/bin/bash"</span>, <span class="s2">"-c"</span><span class="o">]</span>

RUN apt-get update <span class="se">\</span>
 <span class="o">&amp;&amp;</span> apt-get <span class="nt">-y</span> <span class="nb">install</span> <span class="nt">--no-install-recommends</span> git python3-dev wget vim less <span class="se">\</span>
 <span class="o">&amp;&amp;</span> apt-get <span class="nt">-y</span> <span class="nb">install</span> <span class="nt">--no-install-recommends</span> <span class="k">${</span><span class="nv">PACKAGE</span><span class="k">}</span> <span class="se">\</span>
 <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span> <span class="se">\</span>
 <span class="o">&amp;&amp;</span> <span class="nb">cd</span> /usr/lib/openfoam/openfoam2312/ <span class="se">\</span>
 <span class="o">&amp;&amp;</span> <span class="nb">source </span>etc/bashrc <span class="se">\</span>
 <span class="o">&amp;&amp;</span> <span class="nb">source </span>etc/config.sh/petsc <span class="se">\</span>
 <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">--force</span> <span class="nv">$WM_THIRD_PARTY_DIR</span> <span class="se">\</span>
 <span class="o">&amp;&amp;</span> git clone https://develop.openfoam.com/Development/ThirdParty-common <span class="nv">$WM_THIRD_PARTY_DIR</span> <span class="se">\</span>
 <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$WM_THIRD_PARTY_DIR</span> <span class="se">\</span>
 <span class="o">&amp;&amp;</span> wget https://ftp.mcs.anl.gov/pub/petsc/release-snapshots/<span class="nv">$petsc_version</span>.tar.gz <span class="se">\</span>
 <span class="o">&amp;&amp;</span> <span class="nb">tar </span>xzf <span class="nv">$petsc_version</span>.tar.gz <span class="se">\</span>
 <span class="o">&amp;&amp;</span> ./makePETSC <span class="nt">--</span> <span class="nt">--download-f2cblaslapack</span><span class="o">=</span>1 <span class="se">\</span>
 <span class="o">&amp;&amp;</span> git clone https://develop.openfoam.com/modules/external-solver <span class="nv">$WM_THIRD_PARTY_DIR</span>/external-solver <span class="se">\</span>
 <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$WM_THIRD_PARTY_DIR</span>/external-solver <span class="se">\</span>
 <span class="o">&amp;&amp;</span> ./Allwmake <span class="nt">-j</span> 1&gt;stdout.log 2&gt;stderr.log <span class="se">\</span>
 <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"eval </span><span class="si">$(</span>foamEtcFile <span class="nt">-sh</span> <span class="nt">-config</span> petsc <span class="nt">--</span> <span class="nt">-force</span><span class="si">)</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> ~/.bashrc

<span class="c"># ---------------------------------------------------------------------------</span>
</code></pre></div></div> <p>This Dockerfile is constructed using a standard container template provided <a href="https://develop.openfoam.com/packaging/containers" rel="external nofollow noopener" target="_blank">here</a>. You can also download this specific file <a href="https://github.com/goswami-13/OpenFOAM_Docker/blob/main/ofpetsc" rel="external nofollow noopener" target="_blank">here</a>. In this instance, we begin with the official <code class="language-plaintext highlighter-rouge">openfoam2312-default</code> image, built on top of the Ubuntu Bionic image, and incorporate additional tools required for later use, such as wget, vim, less, python3-dev, etc. Following this, we install OpenFOAM and source the <code class="language-plaintext highlighter-rouge">/etc/bashrc</code> and <code class="language-plaintext highlighter-rouge">/etc/config.sh/petsc</code> for compiling PETSc in OpenFOAM. Subsequently, the Dockerfile proceeds to build the PETSc library within OpenFOAM and adds the environment variables to the user’s <code class="language-plaintext highlighter-rouge">~/.bashrc</code> file so that PETSc is loaded by default for the user.</p> <p><strong>PS:</strong> Please disregard the formatting of the Dockerfile. Here, multiple commands are combined using the <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> operator, and for clean code, individual commands are separated onto the next line using the <code class="language-plaintext highlighter-rouge">\</code> operator. This is merely a quirky method to make Docker images slightly smaller.</p> <p>Place this file inside the <code class="language-plaintext highlighter-rouge">/home/goswami/OpenFOAM</code> folder and build the image using the following command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> openfoam_custom <span class="nt">-f</span> ofpetsc <span class="nb">.</span>
</code></pre></div></div> <p>This process may take some time (approximately 10-15 minutes), mainly depending on your internet connection and the specifications of your Mac. Upon completion, you’ll have a customized and Dockerized version of OpenFOAM named <code class="language-plaintext highlighter-rouge">openfoam_custom</code>. To log into your container, use the command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">-ti</span> <span class="nt">-v</span> /home/goswami/OpenFOAM:/home/openfoam openfoam_custom:latest
</code></pre></div></div> <p>To expedite the login process, create an alias inside the <code class="language-plaintext highlighter-rouge">~/.bash_profile</code> by executing the following command in your terminal:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"alias OFCustom='docker run --rm -ti -v /home/goswami/OpenFOAM:/home/openfoam openfoam_custom:latest'"</span> <span class="o">&gt;&gt;</span> ~/.bash_profile
</code></pre></div></div> <p>Don’t forget to close the terminal, open a new one, and simply type <code class="language-plaintext highlighter-rouge">OFCustom</code> to log into the new Docker image. And there you have it!</p> <h2 id="using-openfoam-in-a-docker-container">Using OpenFOAM in a Docker container</h2> <p>Building a Docker image and installing OpenFOAM is relatively straightforward, but how you use OpenFOAM in a container depends heavily on how you built the image. To start, let’s delve into the basics of containers, images, and Docker in general.</p> <p>First, let’s clarify some terminology. The glossary for Docker can be found <a href="https://docs.docker.com/glossary/" rel="external nofollow noopener" target="_blank">here</a>, but here’s a brief overview:</p> <ul> <li>Docker: The platform for developers to develop, ship, and run applications.</li> <li>Docker Daemon: The process running on your computer that manages images and containers.</li> <li>Dockerfile: A text document containing commands used to build a Docker image. It essentially automates the process of manually entering commands to construct an image.</li> <li>Docker image: A collection of code and instructions for the user, such as system libraries and application code.</li> <li>Container: The runtime instance of an image, an executable package (e.g., OpenFOAM) that includes everything needed to run an application.</li> </ul> <p>Let’s examine the command to run the container:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">-ti</span> <span class="nt">-v</span> /home/goswami/OpenFOAM:/home/openfoam openfoam_custom:latest
</code></pre></div></div> <p>Now, let’s break down the command:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">docker run</code>: This command is used to run a Docker container.</li> <li> <code class="language-plaintext highlighter-rouge">--rm</code>: This flag removes the container automatically once it stops running, preventing them from piling up and consuming disk space unnecessarily.</li> <li> <code class="language-plaintext highlighter-rouge">-ti</code>: These flags indicate that we want to run the container in an interactive mode, which allows us to interact with the container via the terminal.</li> <li> <code class="language-plaintext highlighter-rouge">-v /home/goswami/OpenFOAM:/home/openfoam</code>: This flag mounts the local directory <code class="language-plaintext highlighter-rouge">/home/goswami/OpenFOAM</code> to the directory <code class="language-plaintext highlighter-rouge">/home/openfoam</code> inside the container. This is essential for persisting data between the host and the container. Any data stored in <code class="language-plaintext highlighter-rouge">/home/openfoam</code> within the container will be accessible on the host machine in <code class="language-plaintext highlighter-rouge">/home/goswami/OpenFOAM</code>.</li> <li> <code class="language-plaintext highlighter-rouge">openfoam_custom:latest</code>: This specifies the image to be used for running the container. In this case, it’s the openfoam_custom image tagged with <code class="language-plaintext highlighter-rouge">latest</code>.</li> </ul> <p>Executing this command fetches the newly created Docker image and starts a container on your local machine. This container places you into a Bash shell, logged in as the root user, with access to all of the OpenFOAM and PETSc libraries within the container. However, it’s important to note that since this container is built on top of Ubuntu, certain functionalities of Linux are retained, but there is one limitation: ParaView cannot be easily run using the <code class="language-plaintext highlighter-rouge">paraFoam</code> command from within the container.</p> <p>Now, let’s discuss the functionality of OpenFOAM within a container. First and foremost, always mount a volume with your Docker image and run your cases on that volume. Any data stored within the Docker container will be lost once you exit the container. Additionally, running serial cases is straightforward. The primary purpose of running OpenFOAM in Docker on your Mac should be for setting up cases and testing them, rather than running them in their entirety. This is how I typically use my Mac for OpenFOAM. Since Tecplot and ParaView can be easily installed on macOS, you can utilize the powerful GPUs of a MacBook for post-processing.</p> <p>If you absolutely need to run parallel simulations using OpenFOAM on your Mac, you can use the following command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mpirun <span class="nt">--allow-run-as-root</span> <span class="nt">-np</span> 4 simpleFoam <span class="nt">-parallel</span> | <span class="nb">tee </span>log
</code></pre></div></div> <p>Here, the <code class="language-plaintext highlighter-rouge">--allow-run-as-root</code> option is added to the simple <code class="language-plaintext highlighter-rouge">mpirun</code> command for any solver. Since the built image of OpenFOAM with PETSc integrated runs only as the root user, this option allows running multi-core simulations. However, it’s important to proceed with caution, as running <code class="language-plaintext highlighter-rouge">mpirun</code> as a root user may pose security risks. If any readers have suggestions on this matter, please feel free to comment on this article.</p> <p>In conclusion, while macOS has long been favored by developers for its Unix-based environment and intuitive user experience, the integration of OpenFOAM further solidifies its position as a convenient platform for computational fluid dynamics (CFD) enthusiasts. Through the utilization of Docker, the barriers previously associated with running OpenFOAM on non-Linux systems have been effectively overcome. Docker’s containerization technology ensures a consistent and portable development environment, enabling users to seamlessly deploy OpenFOAM and its associated dependencies across various operating systems. With macOS and Docker, developers can enjoy the flexibility and convenience of their preferred environment while exploring the complexities of CFD with OpenFOAM. So whether you’re a seasoned developer or an aspiring enthusiast, macOS coupled with Docker offers a compelling solution for testing, running, and customizing OpenFOAM simulations with ease and efficiency.</p> <p>Happy computing!!!</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/goswami-13/assets/bibliography/"></d-bibliography> <d-article> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/goswami-13/posts/2025/06/blog-post-54/">Tabulating 6-DOF Motion Kinematics in OpenFOAM using Python</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/goswami-13/posts/2025/06/blog-post-53/">Setting Up Overset Mesh Cases in OpenFOAM Made Easy</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/goswami-13/posts/2025/06/blog-post-52/">An Introduction to Overset Mesh in OpenFOAM</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/goswami-13/posts/2025/05/blog-post-51/">Python Tools for Analyzing and Visualizing Mesh Motion Simulations</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/goswami-13/posts/2025/03/blog-post-50/">Simulating Pure Pitching and Heaving Motions in OpenFOAM</a> </li> <br> <br> </d-article> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Shubham Goswami, PhD. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/goswami-13/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script src="/goswami-13/assets/js/distillpub/overrides.js"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js" integrity="sha256-1rA678n2xEx7x4cTZ5x4wpUCj6kUMZEZ5cxLSVSFWxw=" crossorigin="anonymous"></script> <script defer src="/goswami-13/assets/js/mermaid-setup.js?38ca0a0126f7328d2d9a46bad640931f" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/diff2html@3.4.47/bundles/js/diff2html-ui.min.js" integrity="sha256-eU2TVHX633T1o/bTQp6iIJByYJEtZThhF9bKz/DcbbY=" crossorigin="anonymous"></script> <script defer src="/goswami-13/assets/js/diff2html-setup.js?80a6e52ce727518bbd3aed2bb6ba5601" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.js" integrity="sha256-MgH13bFTTNqsnuEoqNPBLDaqxjGH+lCpqrukmXc8Ppg=" crossorigin="anonymous"></script> <script defer src="/goswami-13/assets/js/leaflet-setup.js?b6313931e203b924523e2d8b75fe8874" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" integrity="sha256-0q+JdOlScWOHcunpUk21uab1jW7C1deBQARHtKMcaB4=" crossorigin="anonymous"></script> <script defer src="/goswami-13/assets/js/chartjs-setup.js?183c5859923724fb1cb3c67593848e71" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js" integrity="sha256-QvgynZibb2U53SsVu98NggJXYqwRL7tg3FeyfXvPOUY=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/theme/dark-fresh-cut.js" integrity="sha256-sm6Ui9w41++ZCWmIWDLC18a6ki72FQpWDiYTDxEPXwU=" crossorigin="anonymous"></script> <script defer src="/goswami-13/assets/js/echarts-setup.js?738178999630746a8d0cfc261fc47c2c" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega@5.27.0/build/vega.min.js" integrity="sha256-Yot/cfgMMMpFwkp/5azR20Tfkt24PFqQ6IQS+80HIZs=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega-lite@5.16.3/build/vega-lite.min.js" integrity="sha256-TvBvIS5jUN4BSy009usRjNzjI1qRrHPYv7xVLJyjUyw=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega-embed@6.24.0/build/vega-embed.min.js" integrity="sha256-FPCJ9JYCC9AZSpvC/t/wHBX7ybueZhIqOMjpWqfl3DU=" crossorigin="anonymous"></script> <script defer src="/goswami-13/assets/js/vega-setup.js?7c7bee055efe9312afc861b128fe5f36" type="text/javascript"></script> <script defer src="https://tikzjax.com/v1/tikzjax.js" integrity="sha256-+1qyucCXRZJrCg3lm3KxRt/7WXaYhBid4/1XJRHGB1E=" crossorigin="anonymous"></script> <script src="/goswami-13/assets/js/typograms.js?062e75bede72543443762dc3fe36c7a5"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/goswami-13/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/goswami-13/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/goswami-13/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/goswami-13/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/goswami-13/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/goswami-13/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/goswami-13/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/goswami-13/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/goswami-13/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/goswami-13/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/goswami-13/assets/js/search-data.js"></script> <script src="/goswami-13/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>