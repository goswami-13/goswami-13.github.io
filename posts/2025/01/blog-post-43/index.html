<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Extracting 3D Snapshots from OpenFOAM for Modal Decomposition Analysis | Shubham Goswami, PhD </title> <meta name="author" content="Shubham Goswami, PhD"> <meta name="description" content="Personal and professional website of Shubham Goswami, PhD. "> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/ICON.png?c7fe2dd74e1dc70566e7483ec7cc293d"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://goswami-13.github.io/posts/2025/01/blog-post-43/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.css" integrity="sha256-q9ba7o845pMPFU+zcAll8rv+gC+fSovKsOoNQ6cynuQ=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css" integrity="sha256-Oppd74ucMR5a5Dq96FxjEzGF7tTw2fZ/6ksAqDCM8GY=" crossorigin="anonymous" media="screen and (prefers-color-scheme: light)"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css" integrity="sha256-nyCNAiECsdDHrr/s2OQsp5l9XeY2ZJ0rMepjCT2AkBk=" crossorigin="anonymous" media="screen and (prefers-color-scheme: dark)"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html@3.4.47/bundles/css/diff2html.min.css" integrity="sha256-IMBK4VNZp0ivwefSn51bswdsrhk0HoMTLc2GqFHFBXg=" crossorigin="anonymous"> <link defer rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css"> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Extracting 3D Snapshots from OpenFOAM for Modal Decomposition Analysis",
            "description": "",
            "published": "January 06, 2025",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Shubham</span> Goswami, PhD </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Guides </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Extracting 3D Snapshots from OpenFOAM for Modal Decomposition Analysis</h1> <p></p> </d-title> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> </nav> </d-contents> <p>In Computational Fluid Dynamics (CFD), understanding complex flow dynamics often requires the extraction of meaningful insights from vast simulation data. This blog dives into the essential process of gathering 3D snapshots from OpenFOAM simulations, a crucial step in enabling advanced modal decomposition techniques like SPOD and DMD. By streamlining data collection, we pave the way for uncovering the hidden structures and dynamics within turbulent flows.</p> <figure> <img src="https://goswami-13.github.io/images/Blog1_2025/BlogLogo.gif" width="80%"> </figure> <p>Modern Computational Fluid Dynamics (CFD) simulations generate a wealth of data, offering a window into the intricate dynamics of fluid flows. However, unlocking actionable insights from this data requires more than visualization—it demands robust analytical techniques like modal decomposition. Whether it’s Dynamic Mode Decomposition (DMD), Spectral Proper Orthogonal Decomposition (SPOD), or other methods, the foundation for these techniques lies in assembling a well-structured dataset of time-varying snapshots.</p> <p>In my previous article, I focused primarily on gathering 2D snapshots from simulations, as they are often sufficient for many analyses. However, certain scenarios demand more detailed insights, where the complexity of three-dimensional flow structures comes into play. In such cases, 3D snapshots become essential to capture the full intricacies of the simulated phenomena. In this blog, I focus on the process of gathering 3D snapshots from OpenFOAM simulations, a crucial step for preparing data suitable for modal decomposition. From configuring OpenFOAM to extract volumetric fields to organizing and post-processing the data, we’ll cover practical strategies to make this workflow efficient and accessible. By the end, you’ll have a clear roadmap to extract, organize, and analyze 3D flow data, unlocking its full potential for advanced analysis.</p> <p>Lets Begin!!!</p> <h1 id="example-case">Example Case</h1> <p>To guide this tutorial on extracting 3D snapshots from a simulation, we will focus on the dynamics of three-dimensional flow around a square cylinder at a Reynolds number of 260. The flow will be simulated using Direct Numerical Simulations (DNS) implemented in OpenFOAM, following a setup closely aligned with the configuration outlined by <a href="https://doi.org/10.1063/1.4996945" rel="external nofollow noopener" target="_blank">Bai and Alam (2018)</a> for reference.</p> <p>The choice of this case is intentional. The wake generated behind the cylinder serves as a classic example of periodic (Kármán) vortex shedding—a phenomenon characterized by the alternating shedding of vortices, producing a periodic flow regime defined by a dominant frequency and its harmonics. At a Reynolds number of 260, the wake transitions into a fully three-dimensional structure, showcasing intricate vortex dynamics. These features make it an ideal candidate for this tutorial. Additionally, replicating a well-documented case allows us to effectively validate the simulated flow physics against published results. For guidance on setting up an unsteady case in OpenFOAM, refer to <a href="https://blog.stackademic.com/the-devils-in-the-details-part-2-key-considerations-for-setting-up-complex-unsteady-cases-in-9407c82c16dc" rel="external nofollow noopener" target="_blank">this article</a>.</p> <p>The key aspect of setting up a case for modal decomposition and collecting 3D snapshots lies in correctly configuring the <code class="language-plaintext highlighter-rouge">system</code> folder. This folder serves as the central hub for defining the numerical parameters of your simulation. Before initiating data collection, it is critical to ensure that the flow within the domain has reached a fully developed state. This involves allowing sufficient time for transient effects to subside, ensuring the flow attains stable and representative behavior.</p> <p>A fully developed flow state is achieved when the flow characteristics stabilize and no longer exhibit significant variations over time or distance. For our case, which involves a quasi-periodic vortex shedding phenomenon, the goal is to reach a statistically stationary flow field. This requires running the simulation until random fluctuations diminish and the flow stabilizes. To achieve this, we will initially run the simulation for a duration equivalent to 20 Through Times. A Through Time represents the time it takes for a fluid particle to traverse the domain’s length undisturbed and is calculated as:</p> \[Through-Time = \frac{Domain Length}{U_{ref}}\] <p>By running the simulation for this duration, we can capture a converged transient solution, setting the <code class="language-plaintext highlighter-rouge">system/constant/endTime</code> parameter appropriately.</p> <p>To determine the time step, Δ𝑡, a Courant-Friedrichs-Lewy (CFL) number of ≤ 0.8 is used to ensure numerical stability. Given the minimum element size (Δ𝑥) and the free-stream velocity (𝑈_{ref}), the time step is calculated as:</p> \[\Delta t \leq \frac{0.8\times \Delta x}{U_{ref}}\] <p>This value is then assigned to the <code class="language-plaintext highlighter-rouge">deltaT</code> parameter in the <code class="language-plaintext highlighter-rouge">controlDict</code> file. By adhering to these criteria, we ensure that the time discretization is fine enough to accurately capture the flow dynamics while maintaining numerical stability.</p> <h1 id="snapshot-data-extraction">Snapshot data extraction</h1> <p>Let’s dive into the data collection process, a critical step for performing modal decomposition analysis. Our goal is to capture multiple snapshots of the flow field, each corresponding to a distinct time instance. Following conventions in the literature, the number of snapshots is typically chosen as $2^n$ snapshots, where n depends on the specific case and user requirements. For this case, we will extract between 256 and 1024 snapshots. However, it’s essential to ensure that data collection begins only after the flow has reached a fully developed, statistically stable state. As such, snapshots will be gathered after the <code class="language-plaintext highlighter-rouge">endTime</code> specified in the simulation setup.</p> <p>There are several methods to collect 3D volume snapshots from OpenFOAM simulations. In this tutorial, I will demonstrate one of the simplest approaches—using <code class="language-plaintext highlighter-rouge">functionObjects</code>. Specifically, we’ll use the <code class="language-plaintext highlighter-rouge">vtkWrite</code> function object to extract 3D volume fields from the simulation, as shown below:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  vtkWrite1
	<span class="o">{</span>
		<span class="nb">type            </span>vtkWrite<span class="p">;</span>
		libs            <span class="o">(</span>utilityFunctionObjects<span class="o">)</span><span class="p">;</span>
		//timeStart		889.031<span class="p">;</span>
		//timeEnd         1000<span class="p">;</span>
		writeControl    timeStep<span class="p">;</span>
		writeInterval   25<span class="p">;</span>
		format          ascii<span class="p">;</span>
		legacy          <span class="nb">false</span><span class="p">;</span>
		decompose       <span class="nb">false</span><span class="p">;</span>
		internal		<span class="nb">true</span><span class="p">;</span>
		boundary		<span class="nb">false</span><span class="p">;</span>
		interpolate <span class="nb">true</span><span class="p">;</span>
		fields          <span class="o">(</span>U p<span class="o">)</span><span class="p">;</span>

		selection
		<span class="o">{</span>
			box 
				<span class="o">{</span> 
					action  use<span class="p">;</span> 
					<span class="nb">source  </span>box<span class="p">;</span> 
					box     <span class="o">(</span><span class="nt">-0</span>.2 <span class="nt">-0</span>.5 <span class="nt">-0</span>.6<span class="o">)</span> <span class="o">(</span>2.4 0.5 0.6<span class="o">)</span><span class="p">;</span> 
				<span class="o">}</span> 
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div> <p>This function object writes fields in VTK (XML or legacy) format, allowing for the export of cell-based or point-interpolated values for volume fields. Crucially, it enables the user to define a region of interest through the <code class="language-plaintext highlighter-rouge">selection</code> dictionary. But what exactly do we mean by the region of interest?</p> <p>Below, we illustrate the full 3D domain of the simulated case—flow around a square cylinder at Re=260:</p> <figure> <img src="https://goswami-13.github.io/images/Blog1_2025/FullDomainMesh.jpg" width="80%"> </figure> <p>The meshing of this domain appears as follows:</p> <figure> <img src="https://goswami-13.github.io/images/Blog1_2025/FullDomainMesh2.jpg" width="80%"> </figure> <p>However, for our analysis, we are only interested in a specific region—a 3D box around the square cylinder, as shown below:</p> <figure> <img src="https://goswami-13.github.io/images/Blog1_2025/RegionOfInterest.jpg" width="80%"> </figure> <p>Here is the extracted mesh within the defined region of interest:</p> <figure> <img src="https://goswami-13.github.io/images/Blog1_2025/RegionOfInterest2.jpg" width="80%"> </figure> <p>This region of interest is defined by a bounding box that spans the width and height of the wake. Essentially, we only need the volume fields and mesh information contained within this bounding box. In simpler terms, we aim to extract the 3D mesh region around the flow, as shown below:</p> <figure> <img src="https://goswami-13.github.io/images/Blog1_2025/3D_1.jpeg" width="80%"> </figure> <figure> <img src="https://goswami-13.github.io/images/Blog1_2025/3D_2.jpeg" width="80%"> </figure> <p>To achieve this, we configure the <code class="language-plaintext highlighter-rouge">selection</code> dictionary as follows:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>selection
<span class="o">{</span>
	box 
		<span class="o">{</span> 
			action  use<span class="p">;</span> 
			<span class="nb">source  </span>box<span class="p">;</span> 
			box     <span class="o">(</span><span class="nt">-0</span>.2 <span class="nt">-0</span>.5 <span class="nt">-0</span>.6<span class="o">)</span> <span class="o">(</span>2.4 0.5 0.6<span class="o">)</span><span class="p">;</span> 
		<span class="o">}</span> 
<span class="o">}</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">vtkWrite</code> function is primarily designed to extract cell-centered values of the volume field. However, for modal decomposition applications using Python, point-interpolated values are required. Additionally, we are only interested in the internal fields or volume fields, not the boundary fields. To optimize storage and focus exclusively on point-interpolated values, we will configure the <code class="language-plaintext highlighter-rouge">vtkWrite</code> function object with the following settings:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>internal		<span class="nb">true</span><span class="p">;</span>
boundary		<span class="nb">false</span><span class="p">;</span>
interpolate <span class="nb">true</span><span class="p">;</span>
</code></pre></div></div> <p>Next, I will run the simulation again, starting from the fully developed state and extracting the region defined by the <code class="language-plaintext highlighter-rouge">selection</code> dictionary every 25 <code class="language-plaintext highlighter-rouge">writeInterval</code> steps. This approach will allow me to collect approximately 250 snapshots. Keep an eye out for the following output during the simulation:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vtkWrite1 output Time: 1996.8
    Internal  : <span class="s2">"postProcessing/vtkWrite1/3D_Bai_00037401/internal.vtu"</span>
    volScalarField<span class="o">(</span>p<span class="o">)</span>
    volVectorField<span class="o">(</span>U<span class="o">)</span>
    volScalarField-&gt;point<span class="o">(</span>p<span class="o">)</span>
    volVectorField-&gt;point<span class="o">(</span>U<span class="o">)</span>
</code></pre></div></div> <p>These snapshots will be stored in the <code class="language-plaintext highlighter-rouge">postProcessing</code> folder of your case directory as shown below:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vtkWrite1
├── 3D_Bai.vtm.series
├── 3D_Bai_00037401
│   └── internal.vtu
└── 3D_Bai_00037401.vtm
</code></pre></div></div> <p>In this structure, the <code class="language-plaintext highlighter-rouge">internal.vtu</code> file contains the 3D snapshot data.</p> <h1 id="construction-snapshot-matrix">Construction snapshot matrix</h1> <p>Now, let’s assume you’ve run the simulation and collected at least 250 3D snapshots, all stored in <code class="language-plaintext highlighter-rouge">internal.vtu</code> files, structured as shown earlier. We will now use Python to construct the snapshot matrix, which will later be used for modal decomposition analysis. To get started, open a Jupyter notebook and import the necessary modules:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">matplotlib.colors</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">fluidfoam</span> <span class="k">as</span> <span class="n">fl</span> <span class="c1">### Most Important
</span><span class="kn">import</span> <span class="n">scipy</span> <span class="k">as</span> <span class="n">sp</span>
<span class="kn">from</span> <span class="n">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">io</span>
<span class="kn">import</span> <span class="n">pyvista</span> <span class="k">as</span> <span class="n">pv</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span><span class="sh">'</span><span class="s">font.size</span><span class="sh">'</span> <span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="sh">'</span><span class="s">font.family</span><span class="sh">'</span> <span class="p">:</span> <span class="sh">'</span><span class="s">Times New Roman</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">text.usetex</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
</code></pre></div></div> <p>Next, assign the appropriate path variables and define the location of each snapshot file. At this point, the <code class="language-plaintext highlighter-rouge">internal.vtu</code> file is stored within a subdirectory named <code class="language-plaintext highlighter-rouge">3D_Bai_00037401</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Path variables
</span><span class="n">Path</span> <span class="o">=</span> <span class="sh">'</span><span class="s">E:/Blog_Posts/Simulations/3D_Bai/</span><span class="sh">'</span>
<span class="n">Surfaces</span> <span class="o">=</span> <span class="sh">'</span><span class="s">E:/Blog_Posts/Simulations/3D_Bai/postProcessing/vtkWrite1/</span><span class="sh">'</span>

<span class="c1"># File variables
</span><span class="n">Files</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">listdir</span><span class="p">(</span><span class="n">Surfaces</span><span class="p">)</span>
</code></pre></div></div> <p>Next, I will use PyVista to read the <code class="language-plaintext highlighter-rouge">internal.vtu</code> file and estimate its size:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Data</span> <span class="o">=</span> <span class="n">pv</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">Surfaces</span> <span class="o">+</span> <span class="n">Files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="sh">'</span><span class="s">/internal.vtu</span><span class="sh">'</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">Data</span><span class="p">.</span><span class="n">points</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">shape</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">rows = </span><span class="sh">'</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="sh">'</span><span class="s">, columns = </span><span class="sh">'</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>

<span class="c1">#### Output
#### rows =  624537 , columns =  3
</span></code></pre></div></div> <p>This output indicates that the extracted VTK file contains data at 624,537 points, and each point is represented in a 3D space (x, y, z).</p> <p>Next, let’s read the point arrays contained within this file:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">array_names</span><span class="p">)</span>

<span class="c1">#### Output
#### ['TimeValue', 'p', 'U', 'p', 'U']
</span></code></pre></div></div> <p>Next, we will use a for loop to construct the snapshot matrix. Note that this step can be time-consuming since we are reading 3D VTK files and arranging the data into a tall, thin matrix. As for the data to collect, one can choose either velocity or pressure; however, I opt to use the vorticity matrix for data analysis.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Data</span> <span class="o">=</span> <span class="n">pv</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">Surfaces</span> <span class="o">+</span> <span class="n">Files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="sh">'</span><span class="s">/internal.vtu</span><span class="sh">'</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">Data</span><span class="p">.</span><span class="n">points</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">shape</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">rows = </span><span class="sh">'</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="sh">'</span><span class="s">columns = </span><span class="sh">'</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>

<span class="c1">### For U
</span><span class="n">Snaps</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">Files</span><span class="p">)</span>
<span class="n">data_Vort</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span><span class="n">Snaps</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Snaps</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pv</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">Surfaces</span> <span class="o">+</span> <span class="n">Files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="sh">'</span><span class="s">/internal.vtu</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">gradData</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">compute_derivative</span><span class="p">(</span><span class="sh">'</span><span class="s">U</span><span class="sh">'</span><span class="p">,</span> <span class="n">vorticity</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">grad_pyvis</span> <span class="o">=</span> <span class="n">gradData</span><span class="p">.</span><span class="n">point_data</span><span class="p">[</span><span class="sh">'</span><span class="s">vorticity</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">data_Vort</span><span class="p">[:,</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">reshape</span><span class="p">(</span><span class="n">grad_pyvis</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="sh">'</span><span class="s">F</span><span class="sh">'</span><span class="p">)</span>

<span class="n">np</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="n">Path</span> <span class="o">+</span> <span class="sh">'</span><span class="s">VortZ.npy</span><span class="sh">'</span><span class="p">,</span> <span class="n">data_Vort</span><span class="p">)</span>
</code></pre></div></div> <p>This matrix, <code class="language-plaintext highlighter-rouge">data_Vort</code>, will be used for modal decomposition analysis going forward. Given that we know the size of the file and the shape of the initial data, it will be easy to reconstruct a single data instance using PyVista.</p> <p>In this blog, we’ve walked through the process of extracting 3D snapshots from OpenFOAM simulations and preparing the data for modal decomposition analysis. By leveraging tools like PyVista and carefully configuring function objects, we’ve been able to capture, process, and organize the data into a snapshot matrix ready for further analysis. The approach we’ve discussed not only facilitates efficient data collection but also ensures that the information is structured in a way that is suitable for more advanced techniques like modal decomposition. As we move forward with modal decomposition and other data-driven analyses, the ability to extract and organize high-dimensional flow data will become increasingly important in gaining deeper insights into complex fluid dynamics. In my next article, I will focus on other methods of collecting snapshot data using OpenFOAM.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> <d-article> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/posts/2025/06/blog-post-54/">Tabulating 6-DOF Motion Kinematics in OpenFOAM using Python</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/posts/2025/06/blog-post-53/">Setting Up Overset Mesh Cases in OpenFOAM Made Easy</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/posts/2025/06/blog-post-52/">An Introduction to Overset Mesh in OpenFOAM</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/posts/2025/05/blog-post-51/">Python Tools for Analyzing and Visualizing Mesh Motion Simulations</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/posts/2025/03/blog-post-50/">Simulating Pure Pitching and Heaving Motions in OpenFOAM</a> </li> <br> <br> </d-article> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Shubham Goswami, PhD. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script src="/assets/js/distillpub/overrides.js"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js" integrity="sha256-1rA678n2xEx7x4cTZ5x4wpUCj6kUMZEZ5cxLSVSFWxw=" crossorigin="anonymous"></script> <script defer src="/assets/js/mermaid-setup.js?38ca0a0126f7328d2d9a46bad640931f" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/diff2html@3.4.47/bundles/js/diff2html-ui.min.js" integrity="sha256-eU2TVHX633T1o/bTQp6iIJByYJEtZThhF9bKz/DcbbY=" crossorigin="anonymous"></script> <script defer src="/assets/js/diff2html-setup.js?80a6e52ce727518bbd3aed2bb6ba5601" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.js" integrity="sha256-MgH13bFTTNqsnuEoqNPBLDaqxjGH+lCpqrukmXc8Ppg=" crossorigin="anonymous"></script> <script defer src="/assets/js/leaflet-setup.js?b6313931e203b924523e2d8b75fe8874" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" integrity="sha256-0q+JdOlScWOHcunpUk21uab1jW7C1deBQARHtKMcaB4=" crossorigin="anonymous"></script> <script defer src="/assets/js/chartjs-setup.js?183c5859923724fb1cb3c67593848e71" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js" integrity="sha256-QvgynZibb2U53SsVu98NggJXYqwRL7tg3FeyfXvPOUY=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/theme/dark-fresh-cut.js" integrity="sha256-sm6Ui9w41++ZCWmIWDLC18a6ki72FQpWDiYTDxEPXwU=" crossorigin="anonymous"></script> <script defer src="/assets/js/echarts-setup.js?738178999630746a8d0cfc261fc47c2c" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega@5.27.0/build/vega.min.js" integrity="sha256-Yot/cfgMMMpFwkp/5azR20Tfkt24PFqQ6IQS+80HIZs=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega-lite@5.16.3/build/vega-lite.min.js" integrity="sha256-TvBvIS5jUN4BSy009usRjNzjI1qRrHPYv7xVLJyjUyw=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega-embed@6.24.0/build/vega-embed.min.js" integrity="sha256-FPCJ9JYCC9AZSpvC/t/wHBX7ybueZhIqOMjpWqfl3DU=" crossorigin="anonymous"></script> <script defer src="/assets/js/vega-setup.js?7c7bee055efe9312afc861b128fe5f36" type="text/javascript"></script> <script defer src="https://tikzjax.com/v1/tikzjax.js" integrity="sha256-+1qyucCXRZJrCg3lm3KxRt/7WXaYhBid4/1XJRHGB1E=" crossorigin="anonymous"></script> <script src="/assets/js/typograms.js?062e75bede72543443762dc3fe36c7a5"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>